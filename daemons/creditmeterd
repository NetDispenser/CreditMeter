#!/usr/bin/python3
import os,sys,json,logging
from xmlrpc.server import SimpleXMLRPCServer
from daemon import Daemon
import utils
from utils import *

FORMAT = 'CREDITMETERD: %(message)s'
logging.basicConfig(filename=CREDITMETER_LOG_FULL_PATH,level=logging.DEBUG, format=FORMAT)

class CreditMeterDaemon(Daemon):

	def __init__(self,pidfile):
		Daemon.__init__(self,pidfile)
		logging.debug("creditmeterd.init")

	def keepalive(self,*args):
		username=args[0]
		mac_addrs=args[1]
		return 5

	def run(self):
		logging.debug("run")
		#self.RUNNING=False
		self.server=SimpleXMLRPCServer((CREDITMETER_HOSTNAME,CREDITMETERD_PORT))
		self.server.register_introspection_functions()
		self.server.register_instance(self)
		self.server.serve_forever()


if __name__=="__main__":
	daemon=CreditMeterDaemon(CREDITMETER_PID)
	if len(sys.argv)==2:
		if 'start'==sys.argv[1]:daemon.start()
		elif 'stop'==sys.argv[1]:daemon.stop()
